#Copyright 2017 Google, LLC
#
#Permission is hereby granted, free of charge, to any person obtaining a
#copy of this software and associated documentation files(the "Software"),
#to deal in the Software without restriction, including without limitation
#the rights to use, copy, modify, merge, publish, distribute, sublicense,
#and / or sell copies of the Software, and to permit persons to whom the
#Software is furnished to do so, subject to the following conditions:
#
#The above copyright notice and this permission notice(including the next
#paragraph) shall be included in all copies or substantial portions of the
#Software.
#
#THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL
#THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
#LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
#FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
#IN THE SOFTWARE.

import("../../../mesa.gni")

src_dir = "$mesa_source_root/src/intel/common"

config("common_config") {
  include_dirs = [
    "$mesa_source_root/src/intel",
    "$mesa_source_root/src/mapi",
  ]

  # Suppress warnings the mesa code doesn't comply with.
  cflags = [ "-Wno-conversion" ]
  cflags += [ "-Wno-unused-but-set-variable" ]
  cflags += [ "-Wno-strict-prototypes" ]
}

mesa_source_set("common") {
  sources = [
    "$src_dir/intel_aux_map.c",
    "$src_dir/intel_aux_map.h",
    "$src_dir/intel_batch_decoder_stubs.c",
    "$src_dir/intel_clflush.h",
    "$src_dir/intel_decoder.h",
    "$src_dir/intel_disasm.c",
    "$src_dir/intel_disasm.h",
    "$src_dir/intel_engine.c",
    "$src_dir/intel_engine.h",
    "$src_dir/intel_gem.h",
    "$src_dir/intel_guardband.h",
    "$src_dir/intel_l3_config.c",
    "$src_dir/intel_l3_config.h",
    "$src_dir/intel_magma.c",
    "$src_dir/intel_measure.c",
    "$src_dir/intel_measure.h",
    "$src_dir/intel_pixel_hash.h",
    "$src_dir/intel_sample_positions.c",
    "$src_dir/intel_sample_positions.h",
    "$src_dir/intel_urb_config.c",
    "$src_dir/intel_uuid.c",
    "$src_dir/intel_uuid.h",
  ]

  public_configs = [ ":common_config" ]

  include_dirs = [ "$mesa_source_root/src/mesa" ]

  deps = [
    # Don't depend on libmagma here, do that on executable targets only
    "$mesa_build_root/src:sha1",
    "$mesa_build_root/src/util",
    "//sdk/lib/magma_client:magma_headers",
    "//src/graphics/drivers/msd-intel-gen/include",
  ]

  defines = [ "USE_MAGMA=1" ]
}
