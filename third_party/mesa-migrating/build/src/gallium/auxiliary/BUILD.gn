# Copyright 2023 Google, LLC
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice (including the next
# paragraph) shall be included in all copies or substantial portions of the
# Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
# IN THE SOFTWARE.

import("../../../mesa.gni")

src_dir = "$mesa_source_root/src/gallium/auxiliary"

mesa_source_set("gallivm") {
  sources = [
    "$src_dir/draw/draw_llvm.c",
    "$src_dir/draw/draw_llvm.h",
    "$src_dir/draw/draw_llvm_sample.c",
    "$src_dir/draw/draw_pt_fetch_shade_pipeline_llvm.c",
    "$src_dir/draw/draw_vs_llvm.c",
    "$src_dir/gallivm/lp_bld.h",
    "$src_dir/gallivm/lp_bld_arit.c",
    "$src_dir/gallivm/lp_bld_arit.h",
    "$src_dir/gallivm/lp_bld_arit_overflow.c",
    "$src_dir/gallivm/lp_bld_arit_overflow.h",
    "$src_dir/gallivm/lp_bld_assert.c",
    "$src_dir/gallivm/lp_bld_assert.h",
    "$src_dir/gallivm/lp_bld_bitarit.c",
    "$src_dir/gallivm/lp_bld_bitarit.h",
    "$src_dir/gallivm/lp_bld_const.c",
    "$src_dir/gallivm/lp_bld_const.h",
    "$src_dir/gallivm/lp_bld_conv.c",
    "$src_dir/gallivm/lp_bld_conv.h",
    "$src_dir/gallivm/lp_bld_coro.c",
    "$src_dir/gallivm/lp_bld_coro.h",
    "$src_dir/gallivm/lp_bld_debug.cpp",
    "$src_dir/gallivm/lp_bld_debug.h",
    "$src_dir/gallivm/lp_bld_flow.c",
    "$src_dir/gallivm/lp_bld_flow.h",
    "$src_dir/gallivm/lp_bld_format.c",
    "$src_dir/gallivm/lp_bld_format.h",
    "$src_dir/gallivm/lp_bld_format_aos.c",
    "$src_dir/gallivm/lp_bld_format_aos_array.c",
    "$src_dir/gallivm/lp_bld_format_float.c",
    "$src_dir/gallivm/lp_bld_format_s3tc.c",
    "$src_dir/gallivm/lp_bld_format_soa.c",
    "$src_dir/gallivm/lp_bld_format_srgb.c",
    "$src_dir/gallivm/lp_bld_format_yuv.c",
    "$src_dir/gallivm/lp_bld_fuchsia_memory_mapper.cpp",
    "$src_dir/gallivm/lp_bld_fuchsia_memory_mapper.hpp",
    "$src_dir/gallivm/lp_bld_gather.c",
    "$src_dir/gallivm/lp_bld_gather.h",
    "$src_dir/gallivm/lp_bld_init.c",
    "$src_dir/gallivm/lp_bld_init.h",
    "$src_dir/gallivm/lp_bld_intr.c",
    "$src_dir/gallivm/lp_bld_intr.h",
    "$src_dir/gallivm/lp_bld_ir_common.c",
    "$src_dir/gallivm/lp_bld_ir_common.h",
    "$src_dir/gallivm/lp_bld_jit_types.c",
    "$src_dir/gallivm/lp_bld_jit_types.h",
    "$src_dir/gallivm/lp_bld_limits.h",
    "$src_dir/gallivm/lp_bld_logic.c",
    "$src_dir/gallivm/lp_bld_logic.h",
    "$src_dir/gallivm/lp_bld_misc.cpp",
    "$src_dir/gallivm/lp_bld_misc.h",
    "$src_dir/gallivm/lp_bld_nir.c",
    "$src_dir/gallivm/lp_bld_nir.h",
    "$src_dir/gallivm/lp_bld_nir_aos.c",
    "$src_dir/gallivm/lp_bld_nir_soa.c",
    "$src_dir/gallivm/lp_bld_pack.c",
    "$src_dir/gallivm/lp_bld_pack.h",
    "$src_dir/gallivm/lp_bld_printf.c",
    "$src_dir/gallivm/lp_bld_printf.h",
    "$src_dir/gallivm/lp_bld_quad.c",
    "$src_dir/gallivm/lp_bld_quad.h",
    "$src_dir/gallivm/lp_bld_sample.c",
    "$src_dir/gallivm/lp_bld_sample.h",
    "$src_dir/gallivm/lp_bld_sample_aos.c",
    "$src_dir/gallivm/lp_bld_sample_aos.h",
    "$src_dir/gallivm/lp_bld_sample_soa.c",
    "$src_dir/gallivm/lp_bld_struct.c",
    "$src_dir/gallivm/lp_bld_struct.h",
    "$src_dir/gallivm/lp_bld_swizzle.c",
    "$src_dir/gallivm/lp_bld_swizzle.h",
    "$src_dir/gallivm/lp_bld_tgsi.c",
    "$src_dir/gallivm/lp_bld_tgsi.h",
    "$src_dir/gallivm/lp_bld_tgsi_action.c",
    "$src_dir/gallivm/lp_bld_tgsi_action.h",
    "$src_dir/gallivm/lp_bld_tgsi_aos.c",
    "$src_dir/gallivm/lp_bld_tgsi_info.c",
    "$src_dir/gallivm/lp_bld_tgsi_soa.c",
    "$src_dir/gallivm/lp_bld_type.c",
    "$src_dir/gallivm/lp_bld_type.h",
    "$src_dir/nir/nir_to_tgsi_info.c",
    "$src_dir/nir/nir_to_tgsi_info.h",
    "$src_dir/tessellator/p_tessellator.cpp",
    "$src_dir/tessellator/p_tessellator.h",
    "$src_dir/tessellator/tessellator.cpp",
    "$src_dir/tessellator/tessellator.hpp",
  ]

  include_dirs = [
    "$mesa_source_root/include/",
    "$mesa_source_root/src/compiler/nir",
    src_dir,
    "$mesa_source_root/src/gallium/include/",
    "$mesa_source_root/src/",
  ]

  deps = [
    ":gen",
    "$mesa_build_root/src/compiler/nir",

    # TODO(https://fxbug.dev/321122796):
    # These are for marking JIT memory as executable in lp_bld_fuchsia_memory_mapper.cpp.
    # Perhaps this functionality should be moved into a separate target?
    "//sdk/fidl/fuchsia.vulkan.loader:fuchsia.vulkan.loader_cpp",
  ]

  # Suppress warnings.
  configs = [
    "$mesa_build_root/..:build_config",
    "//build/config:Wno-strict-prototypes",
    "//build/config:Wno-unused-but-set-variable",
    "$mesa_build_root/..:LLVMHeader_config",
  ]

  # Unlike the Fuchsia default, ASAN-UBSAN builds don't have "no_rtti".  This causes problems when
  # linking with the LLVM prebuilts, which are built without RTTI.
  if (is_ubsan) {
    configs += [ "//build/config:no_rtti" ]
  }
}

mesa_source_set("auxiliary") {
  deps = [
    ":gallivm",
    ":gen",
    "$mesa_build_root/src/compiler/nir",
  ]

  sources = [
    "$src_dir/cso_cache/cso_cache.c",
    "$src_dir/cso_cache/cso_cache.h",
    "$src_dir/cso_cache/cso_context.c",
    "$src_dir/cso_cache/cso_context.h",
    "$src_dir/cso_cache/cso_hash.c",
    "$src_dir/cso_cache/cso_hash.h",
    "$src_dir/draw/draw_cliptest_tmp.h",
    "$src_dir/draw/draw_context.c",
    "$src_dir/draw/draw_context.h",
    "$src_dir/draw/draw_decompose_tmp.h",
    "$src_dir/draw/draw_fs.c",
    "$src_dir/draw/draw_fs.h",
    "$src_dir/draw/draw_gs.c",
    "$src_dir/draw/draw_gs.h",
    "$src_dir/draw/draw_gs_tmp.h",
    "$src_dir/draw/draw_pipe.c",
    "$src_dir/draw/draw_pipe.h",
    "$src_dir/draw/draw_pipe_aaline.c",
    "$src_dir/draw/draw_pipe_aapoint.c",
    "$src_dir/draw/draw_pipe_clip.c",
    "$src_dir/draw/draw_pipe_cull.c",
    "$src_dir/draw/draw_pipe_flatshade.c",
    "$src_dir/draw/draw_pipe_offset.c",
    "$src_dir/draw/draw_pipe_pstipple.c",
    "$src_dir/draw/draw_pipe_stipple.c",
    "$src_dir/draw/draw_pipe_twoside.c",
    "$src_dir/draw/draw_pipe_unfilled.c",
    "$src_dir/draw/draw_pipe_user_cull.c",
    "$src_dir/draw/draw_pipe_util.c",
    "$src_dir/draw/draw_pipe_validate.c",
    "$src_dir/draw/draw_pipe_vbuf.c",
    "$src_dir/draw/draw_pipe_wide_line.c",
    "$src_dir/draw/draw_pipe_wide_point.c",
    "$src_dir/draw/draw_prim_assembler.c",
    "$src_dir/draw/draw_prim_assembler.h",
    "$src_dir/draw/draw_prim_assembler_tmp.h",
    "$src_dir/draw/draw_private.h",
    "$src_dir/draw/draw_pt.c",
    "$src_dir/draw/draw_pt.h",
    "$src_dir/draw/draw_pt_decompose.h",
    "$src_dir/draw/draw_pt_emit.c",
    "$src_dir/draw/draw_pt_fetch.c",
    "$src_dir/draw/draw_pt_fetch_shade_emit.c",
    "$src_dir/draw/draw_pt_fetch_shade_pipeline.c",
    "$src_dir/draw/draw_pt_post_vs.c",
    "$src_dir/draw/draw_pt_so_emit.c",
    "$src_dir/draw/draw_pt_util.c",
    "$src_dir/draw/draw_pt_vsplit.c",
    "$src_dir/draw/draw_pt_vsplit_tmp.h",
    "$src_dir/draw/draw_so_emit_tmp.h",
    "$src_dir/draw/draw_split_tmp.h",
    "$src_dir/draw/draw_tess.c",
    "$src_dir/draw/draw_tess.h",
    "$src_dir/draw/draw_vbuf.h",
    "$src_dir/draw/draw_vertex.c",
    "$src_dir/draw/draw_vertex.h",
    "$src_dir/draw/draw_vs.c",
    "$src_dir/draw/draw_vs.h",
    "$src_dir/draw/draw_vs_exec.c",
    "$src_dir/draw/draw_vs_variant.c",
    "$src_dir/driver_ddebug/dd_context.c",
    "$src_dir/driver_ddebug/dd_draw.c",
    "$src_dir/driver_ddebug/dd_pipe.h",
    "$src_dir/driver_ddebug/dd_public.h",
    "$src_dir/driver_ddebug/dd_screen.c",
    "$src_dir/driver_ddebug/dd_util.h",
    "$src_dir/driver_noop/noop_pipe.c",
    "$src_dir/driver_noop/noop_public.h",
    "$src_dir/driver_noop/noop_state.c",
    "$src_dir/driver_trace/tr_context.c",
    "$src_dir/driver_trace/tr_context.h",
    "$src_dir/driver_trace/tr_dump.c",
    "$src_dir/driver_trace/tr_dump.h",
    "$src_dir/driver_trace/tr_dump_defines.h",
    "$src_dir/driver_trace/tr_dump_state.c",
    "$src_dir/driver_trace/tr_dump_state.h",
    "$src_dir/driver_trace/tr_public.h",
    "$src_dir/driver_trace/tr_screen.c",
    "$src_dir/driver_trace/tr_screen.h",
    "$src_dir/driver_trace/tr_texture.c",
    "$src_dir/driver_trace/tr_texture.h",
    "$src_dir/hud/font.c",
    "$src_dir/hud/font.h",
    "$src_dir/hud/hud_context.c",
    "$src_dir/hud/hud_context.h",
    "$src_dir/hud/hud_cpu.c",
    "$src_dir/hud/hud_cpufreq.c",
    "$src_dir/hud/hud_diskstat.c",
    "$src_dir/hud/hud_driver_query.c",
    "$src_dir/hud/hud_fps.c",
    "$src_dir/hud/hud_nic.c",
    "$src_dir/hud/hud_private.h",
    "$src_dir/hud/hud_sensors_temp.c",
    "$src_dir/indices/u_indices.h",
    "$src_dir/indices/u_indices_priv.h",
    "$src_dir/indices/u_primconvert.c",
    "$src_dir/indices/u_primconvert.h",
    "$src_dir/nir/nir_draw_helpers.c",
    "$src_dir/nir/nir_draw_helpers.h",
    "$src_dir/nir/nir_helpers.c",
    "$src_dir/nir/nir_helpers.h",
    "$src_dir/nir/nir_to_tgsi.c",
    "$src_dir/nir/nir_to_tgsi.h",
    "$src_dir/nir/tgsi_to_nir.c",
    "$src_dir/nir/tgsi_to_nir.h",
    "$src_dir/os/os_mman.h",
    "$src_dir/os/os_process.c",
    "$src_dir/os/os_process.h",
    "$src_dir/os/os_thread.h",
    "$src_dir/pipebuffer/pb_buffer.h",
    "$src_dir/pipebuffer/pb_buffer_fenced.c",
    "$src_dir/pipebuffer/pb_buffer_fenced.h",
    "$src_dir/pipebuffer/pb_bufmgr.h",
    "$src_dir/pipebuffer/pb_bufmgr_cache.c",
    "$src_dir/pipebuffer/pb_bufmgr_debug.c",
    "$src_dir/pipebuffer/pb_bufmgr_mm.c",
    "$src_dir/pipebuffer/pb_bufmgr_slab.c",
    "$src_dir/pipebuffer/pb_cache.c",
    "$src_dir/pipebuffer/pb_cache.h",
    "$src_dir/pipebuffer/pb_slab.c",
    "$src_dir/pipebuffer/pb_slab.h",
    "$src_dir/pipebuffer/pb_validate.c",
    "$src_dir/pipebuffer/pb_validate.h",
    "$src_dir/postprocess/filters.h",
    "$src_dir/postprocess/postprocess.h",
    "$src_dir/postprocess/pp_celshade.c",
    "$src_dir/postprocess/pp_celshade.h",
    "$src_dir/postprocess/pp_colors.c",
    "$src_dir/postprocess/pp_colors.h",
    "$src_dir/postprocess/pp_filters.h",
    "$src_dir/postprocess/pp_init.c",
    "$src_dir/postprocess/pp_mlaa.c",
    "$src_dir/postprocess/pp_mlaa.h",
    "$src_dir/postprocess/pp_mlaa_areamap.h",
    "$src_dir/postprocess/pp_private.h",
    "$src_dir/postprocess/pp_program.c",
    "$src_dir/postprocess/pp_run.c",
    "$src_dir/rtasm/rtasm_execmem.c",
    "$src_dir/rtasm/rtasm_execmem.h",
    "$src_dir/rtasm/rtasm_x86sse.c",
    "$src_dir/rtasm/rtasm_x86sse.h",
    "$src_dir/tgsi/tgsi_aa_point.c",
    "$src_dir/tgsi/tgsi_aa_point.h",
    "$src_dir/tgsi/tgsi_build.c",
    "$src_dir/tgsi/tgsi_build.h",
    "$src_dir/tgsi/tgsi_dump.c",
    "$src_dir/tgsi/tgsi_dump.h",
    "$src_dir/tgsi/tgsi_dynamic_indexing.c",
    "$src_dir/tgsi/tgsi_exec.c",
    "$src_dir/tgsi/tgsi_exec.h",
    "$src_dir/tgsi/tgsi_from_mesa.c",
    "$src_dir/tgsi/tgsi_from_mesa.h",
    "$src_dir/tgsi/tgsi_info.c",
    "$src_dir/tgsi/tgsi_info.h",
    "$src_dir/tgsi/tgsi_info_opcodes.h",
    "$src_dir/tgsi/tgsi_iterate.c",
    "$src_dir/tgsi/tgsi_iterate.h",
    "$src_dir/tgsi/tgsi_lowering.c",
    "$src_dir/tgsi/tgsi_lowering.h",
    "$src_dir/tgsi/tgsi_opcode_tmp.h",
    "$src_dir/tgsi/tgsi_parse.c",
    "$src_dir/tgsi/tgsi_parse.h",
    "$src_dir/tgsi/tgsi_point_sprite.c",
    "$src_dir/tgsi/tgsi_point_sprite.h",
    "$src_dir/tgsi/tgsi_sanity.c",
    "$src_dir/tgsi/tgsi_sanity.h",
    "$src_dir/tgsi/tgsi_scan.c",
    "$src_dir/tgsi/tgsi_scan.h",
    "$src_dir/tgsi/tgsi_strings.c",
    "$src_dir/tgsi/tgsi_strings.h",
    "$src_dir/tgsi/tgsi_text.c",
    "$src_dir/tgsi/tgsi_text.h",
    "$src_dir/tgsi/tgsi_transform.c",
    "$src_dir/tgsi/tgsi_transform.h",
    "$src_dir/tgsi/tgsi_two_side.c",
    "$src_dir/tgsi/tgsi_two_side.h",
    "$src_dir/tgsi/tgsi_ureg.c",
    "$src_dir/tgsi/tgsi_ureg.h",
    "$src_dir/tgsi/tgsi_util.c",
    "$src_dir/tgsi/tgsi_util.h",
    "$src_dir/tgsi/tgsi_vpos.c",
    "$src_dir/translate/translate.c",
    "$src_dir/translate/translate.h",
    "$src_dir/translate/translate_cache.c",
    "$src_dir/translate/translate_cache.h",
    "$src_dir/translate/translate_generic.c",
    "$src_dir/translate/translate_sse.c",
    "$src_dir/util/dbghelp.h",
    "$src_dir/util/u_async_debug.c",
    "$src_dir/util/u_async_debug.h",
    "$src_dir/util/u_bitcast.h",
    "$src_dir/util/u_bitmask.c",
    "$src_dir/util/u_bitmask.h",
    "$src_dir/util/u_blend.h",
    "$src_dir/util/u_blitter.c",
    "$src_dir/util/u_blitter.h",
    "$src_dir/util/u_box.h",
    "$src_dir/util/u_cache.c",
    "$src_dir/util/u_cache.h",
    "$src_dir/util/u_compute.c",
    "$src_dir/util/u_compute.h",
    "$src_dir/util/u_debug_cb.h",
    "$src_dir/util/u_debug_flush.c",
    "$src_dir/util/u_debug_flush.h",
    "$src_dir/util/u_debug_image.c",
    "$src_dir/util/u_debug_image.h",
    "$src_dir/util/u_dirty_flags.h",
    "$src_dir/util/u_dirty_surfaces.h",
    "$src_dir/util/u_draw.c",
    "$src_dir/util/u_draw.h",
    "$src_dir/util/u_draw_quad.c",
    "$src_dir/util/u_draw_quad.h",
    "$src_dir/util/u_driconf.c",
    "$src_dir/util/u_driconf.h",
    "$src_dir/util/u_dual_blend.h",
    "$src_dir/util/u_dump.h",
    "$src_dir/util/u_dump_defines.c",
    "$src_dir/util/u_dump_state.c",
    "$src_dir/util/u_framebuffer.c",
    "$src_dir/util/u_framebuffer.h",
    "$src_dir/util/u_gen_mipmap.c",
    "$src_dir/util/u_gen_mipmap.h",
    "$src_dir/util/u_handle_table.c",
    "$src_dir/util/u_handle_table.h",
    "$src_dir/util/u_helpers.c",
    "$src_dir/util/u_helpers.h",
    "$src_dir/util/u_index_modify.c",
    "$src_dir/util/u_index_modify.h",
    "$src_dir/util/u_inlines.h",
    "$src_dir/util/u_linear.c",
    "$src_dir/util/u_linear.h",
    "$src_dir/util/u_live_shader_cache.c",
    "$src_dir/util/u_live_shader_cache.h",
    "$src_dir/util/u_log.c",
    "$src_dir/util/u_log.h",
    "$src_dir/util/u_pack_color.h",
    "$src_dir/util/u_prim.c",
    "$src_dir/util/u_prim.h",
    "$src_dir/util/u_prim_restart.c",
    "$src_dir/util/u_prim_restart.h",
    "$src_dir/util/u_pstipple.c",
    "$src_dir/util/u_pstipple.h",
    "$src_dir/util/u_pwr8.h",
    "$src_dir/util/u_range.h",
    "$src_dir/util/u_rect.h",
    "$src_dir/util/u_resource.c",
    "$src_dir/util/u_resource.h",
    "$src_dir/util/u_sampler.c",
    "$src_dir/util/u_sampler.h",
    "$src_dir/util/u_screen.c",
    "$src_dir/util/u_screen.h",
    "$src_dir/util/u_simple_shaders.c",
    "$src_dir/util/u_simple_shaders.h",
    "$src_dir/util/u_split_draw.c",
    "$src_dir/util/u_split_draw.h",
    "$src_dir/util/u_split_prim.h",
    "$src_dir/util/u_sse.h",
    "$src_dir/util/u_suballoc.c",
    "$src_dir/util/u_suballoc.h",
    "$src_dir/util/u_surface.c",
    "$src_dir/util/u_surface.h",
    "$src_dir/util/u_tests.c",
    "$src_dir/util/u_tests.h",
    "$src_dir/util/u_texture.c",
    "$src_dir/util/u_texture.h",
    "$src_dir/util/u_threaded_context.c",
    "$src_dir/util/u_threaded_context.h",
    "$src_dir/util/u_threaded_context_calls.h",
    "$src_dir/util/u_tile.c",
    "$src_dir/util/u_tile.h",
    "$src_dir/util/u_trace_gallium.c",
    "$src_dir/util/u_trace_gallium.h",
    "$src_dir/util/u_transfer.c",
    "$src_dir/util/u_transfer.h",
    "$src_dir/util/u_transfer_helper.c",
    "$src_dir/util/u_transfer_helper.h",
    "$src_dir/util/u_upload_mgr.c",
    "$src_dir/util/u_upload_mgr.h",
    "$src_dir/util/u_vbuf.c",
    "$src_dir/util/u_vbuf.h",
    "$src_dir/util/u_vertex_state_cache.c",
    "$src_dir/util/u_vertex_state_cache.h",
    "$src_dir/util/u_video.h",
    "$src_dir/util/u_viewport.h",
  ]

  configs = [
    ":build_config",
    "//build/config:Wno-strict-prototypes",
    "$mesa_build_root/..:build_config",
  ]
}

config("build_config") {
  include_dirs = [
    "$mesa_source_root/include/",
    "$mesa_source_root/src/compiler/nir/",
    src_dir,
    "$mesa_source_root/src/gallium/include/",
    "$mesa_source_root/src/util/",
    "$mesa_source_root/src/",
    "$target_gen_dir",
  ]

  configs = [ "$mesa_build_root/..:LLVMHeader_config" ]
}

mesa_python_action("tr_util_gen") {
  h_file = "$target_gen_dir/driver_trace/tr_util.h"
  c_file = "$target_gen_dir/driver_trace/tr_util.c"

  outputs = [
    h_file,
    c_file,
  ]

  script = "$src_dir/driver_trace/enums2names.py"

  inputs = [ "$mesa_source_root/src/gallium/include/pipe/p_defines.h" ]

  args = [
    rebase_path("$mesa_source_root", root_build_dir) +
        "/src/gallium/include/pipe/p_defines.h",
    "-C",
    rebase_path(c_file, root_build_dir),
    "-H",
    rebase_path(h_file, root_build_dir),
    "-I",
    "tr_util.h",
  ]
}

mesa_python_action("u_indices_gen") {
  output_path = "$target_gen_dir/indices/u_indices_gen.c"

  outputs = [ output_path ]
  script = "$src_dir/indices/u_indices_gen.py"

  args = [ rebase_path(output_path, root_build_dir) ]
}

mesa_python_action("u_tracepoints_gen") {
  output_path = "$target_gen_dir/u_tracepoints.h"

  script = "$src_dir/util/u_tracepoints.py"
  outputs = [ output_path ]

  inputs = [ "$mesa_source_root/src/util/perf/u_trace.py" ]

  args = [
    "-p",
    rebase_path("$mesa_source_root/src/util/perf", root_build_dir),
    "-H",
    rebase_path(output_path, root_build_dir),
  ]
}

mesa_python_action("u_unfilled_gen") {
  output_path = "$target_gen_dir/indices/u_unfilled_gen.c"

  outputs = [ output_path ]
  script = "$src_dir/indices/u_unfilled_gen.py"

  args = [ rebase_path(output_path, root_build_dir) ]
}

config("gen_public_config") {
  include_dirs = [
    target_gen_dir,
    "$mesa_source_root/include/",
    "$mesa_source_root/src/",
    src_dir,
    "$src_dir/driver_trace/",
    "$mesa_source_root/src/gallium/include/",
    "$mesa_source_root/src/util/",
    "$target_gen_dir/driver_trace/",
  ]
}

mesa_source_set("gen") {
  public_configs = [ ":gen_public_config" ]

  deps = [
    ":tr_util_gen",
    ":u_indices_gen",
    ":u_tracepoints_gen",
    ":u_unfilled_gen",
  ]

  sources = [
    "$target_gen_dir/driver_trace/tr_util.c",
    "$target_gen_dir/driver_trace/tr_util.h",
    "$target_gen_dir/indices/u_indices_gen.c",
    "$target_gen_dir/indices/u_unfilled_gen.c",
    "$target_gen_dir/u_tracepoints.h",
  ]
}
